<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Firestore Example</title>
</head>
<body>
    <h1>Firebase Firestore CRUD Example</h1>

    <h2>Firestore Operations</h2>
    <button id="addUser">Add User</button>
    <button id="readUser">Read User</button>
    <button id="updateUser">Update User</button>
    <button id="deleteUser">Delete User</button>
    <pre id="result"></pre>

    <script type="module">
        // **1. Import Firebase Modules**
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, doc, addDoc, getDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // **2. Firebase Configuration**
        const firebaseConfig = {
            apiKey: "AIzaSyBb2-D3G0xvbMepV1RtFCawFMbQpVaplj4",
            authDomain: "test-efac0.firebaseapp.com",
            projectId: "test-efac0",
            storageBucket: "test-efac0.appspot.com",
            messagingSenderId: "281809758982",
            appId: "1:281809758982:web:470e75aeebfc659bf74c87",
            measurementId: "G-M4C9K5211J"
        };

        // **3. Initialize Firebase**
        const app = initializeApp(firebaseConfig);

        // **4. Initialize Firestore & Authentication**
        const auth = getAuth(app);
        const firestore = getFirestore(app);

        let resultElement = document.getElementById("result");

        // **5. Authentication Listener**
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("User is signed in:", user);
            } else {
                console.log("No user is signed in.");
            }
        });

        // **6. Firestore CRUD Operations**
        async function addUser() {
            const userName = prompt("Enter user name:");
            const userAge = prompt("Enter user age:");
            const userCity = prompt("Enter user city:");

            try {
                const docRef = await addDoc(collection(firestore, "users"), {
                    name: userName,
                    age: parseInt(userAge),
                    city: userCity
                });
                console.log("Document written with ID:", docRef.id);
                resultElement.innerText = "User added with ID: " + docRef.id;
            } catch (error) {
                console.error("Error adding document:", error);
            }
        }

        async function readUser() {
            const userId = prompt("Enter user ID to read:");

            try {
                const docRef = doc(firestore, "users", userId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    console.log("Document data:", docSnap.data());
                    resultElement.innerText = "User Data: " + JSON.stringify(docSnap.data(), null, 2);
                } else {
                    console.log("No such document!");
                    resultElement.innerText = "No such document!";
                }
            } catch (error) {
                console.error("Error getting document:", error);
            }
        }

        async function updateUser() {
            const userId = prompt("Enter user ID to update:");
            const newAge = prompt("Enter new age:");

            try {
                const docRef = doc(firestore, "users", userId);
                await updateDoc(docRef, {
                    age: parseInt(newAge)
                });
                console.log("Document successfully updated!");
                resultElement.innerText = "User age updated!";
            } catch (error) {
                console.error("Error updating document:", error);
            }
        }

        async function deleteUser() {
            const userId = prompt("Enter user ID to delete:");

            try {
                const docRef = doc(firestore, "users", userId);
                await deleteDoc(docRef);
                console.log("Document successfully deleted!");
                resultElement.innerText = "User deleted!";
            } catch (error) {
                console.error("Error deleting document:", error);
            }
        }

        // **7. Attach Functions to Buttons**
        document.getElementById("addUser").addEventListener("click", addUser);
        document.getElementById("readUser").addEventListener("click", readUser);
        document.getElementById("updateUser").addEventListener("click", updateUser);
        document.getElementById("deleteUser").addEventListener("click", deleteUser);
    </script>
</body>
</html>